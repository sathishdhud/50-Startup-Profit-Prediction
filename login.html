<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login / Create Account</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
  --orange:#ff5722;
  --light:#f1f3f6;
}

/* ðŸ”’ DISABLE SCROLL */
html, body{
  height:100%;
  overflow:hidden;
}

/* BODY CENTER */
body{
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(180deg,#e6f4ff 0%, #ffffff 70%);
  font-family:Arial, Helvetica, sans-serif;
}

/* ============ DESKTOP ============ */
.desktop-wrapper{
  display:flex;
  align-items:center;
  justify-content:center;
}

.auth-box{
  width:820px;
  background:#fff;
  display:flex;
  box-shadow:0 10px 30px rgba(0,0,0,.18);
}

/* LEFT */
.auth-left{
  width:40%;
  background:var(--orange);
  color:#fff;
  padding:50px 35px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.auth-left h2{font-size:28px;font-weight:700;}
.auth-left p{font-size:16px;opacity:.95;}
.auth-left img{max-width:90%;}

/* RIGHT */
.auth-right{
  width:60%;
  padding:45px 35px;
}

.form-control{
  border:none;
  border-bottom:1px solid #bbb;
  border-radius:0;
  padding:12px 5px;
}
.form-control:focus{
  box-shadow:none;
  border-bottom:2px solid var(--orange);
}

.btn-main{
  background:var(--orange);
  color:#fff;
  padding:12px;
  font-weight:600;
  border:none;
}
.btn-main:hover{background:#e64a19;}

.link{
  color:var(--orange);
  font-weight:600;
  cursor:pointer;
  font-size:14px;
}

.hidden{display:none;}

/* ============ MOBILE ============ */
.mobile-auth-page{
  display:flex;
  align-items:center;
  justify-content:center;
}

.mobile-wrapper{
  width:100%;
  max-width:380px;
  background:#fff;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
  border-radius:3px;
  overflow:hidden;
}

.mobile-header{
  background:var(--orange);
  color:#fff;
  text-align:center;
  padding:24px 20px 16px;
}
.mobile-header img{
  height:42px;
  margin-bottom:12px;
}
.mobile-header h2{
  font-size:22px;
  font-weight:700;
}
.mobile-header p{
  font-size:14px;
}

.mobile-form{
  padding:20px;
}

.form-control{
  height:44px;
  font-size:14px;
  border-radius:2px;
}

/* VISIBILITY */
@media(max-width:768px){
  .desktop-wrapper{display:none;}
}
@media(min-width:769px){
  .mobile-auth-page{display:none;}
}

/* ================= MOBILE TIGHT LAYOUT ================= */
@media (max-width: 768px){

  body{
    padding:0;
  }

  .mobile-auth-page{
    width:100%;
    height:100%;
    padding:25px;              /* â¬… closer to edges */
    align-items:center;   /* â¬… avoid vertical shrink */
  }

  .mobile-wrapper{
    width:100%;
    max-width:100%;           /* â¬… full width */
    border-radius:2px;        /* subtle, not bulky */
    box-shadow:0 8px 20px rgba(0,0,0,0.12);
  }

  .mobile-header{
    padding:20px 16px 14px;   /* â¬… tighter */
  }

  .mobile-header img{
    height:38px;
    margin-bottom:8px;
  }

  .mobile-header h2{
    font-size:21px;
  }

  .mobile-header p{
    font-size:13px;
  }

  .mobile-form{
    padding:16px;             /* â¬… tighter form */
  }

  .form-control{
    height:42px;
    font-size:14px;
  }

  .btn-main{
    height:44px;
    font-size:15px;
  }
}
</style>
</head>

<body>

<!-- DESKTOP -->
<div class="desktop-wrapper">
  <div class="auth-box">

    <div class="auth-left">
      <div>
        <h2 id="leftTitle">Login</h2>
        <p id="leftDesc">Get access to your Orders, Wishlist and Recommendations</p>
      </div>
      <img src="https://picsum.photos/seed/logo123/200/100.jpg" alt="Logo">
    </div>

    <div class="auth-right">
      <div id="loginForm">
        <h5>Enter Email / Mobile number</h5>
        <input class="form-control mb-4" placeholder="Email or Mobile Number" id="email">
        <button class="btn-main w-100 mb-3" onclick="sendOTP()">Request OTP</button>
        <div class="text-center">
          <span class="link" onclick="showRegister()">New here? Create an account</span>
        </div>
      </div>

      <div id="registerForm" class="hidden">
        <h5>Create Account</h5>
        <input class="form-control mb-3" placeholder="Full Name" id="registerName">
        <input class="form-control mb-3" placeholder="Email" id="registerEmail">
        <input class="form-control mb-3" placeholder="Mobile" id="registerMobile">
        <button class="btn-main w-100 mb-3" onclick="register()">Create Account</button>
        <div class="text-center">
          <span class="link" onclick="showLogin()">Back to Login</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- MOBILE -->
<div class="mobile-auth-page">
  <div class="mobile-wrapper">

    <div class="mobile-header">
      <img src="https://picsum.photos/seed/logo123/200/100.jpg">
      <h2 id="mTitle">Login</h2>
      <p id="mDesc">Access orders, wishlist & offers</p>
    </div>

    <div class="mobile-form">

      <div id="mLogin">
        <input class="form-control mb-3" placeholder="Email or Mobile Number" id="mEmail">
        <button class="btn-main w-100 mb-3" onclick="sendOTP()">Request OTP</button>
        <div class="text-center">
          <span class="link" onclick="showMobileRegister()">Create new account</span>
        </div>
      </div>

      <div id="mRegister" class="hidden">
        <input class="form-control mb-3" placeholder="Full Name" id="mRegisterName">
        <input class="form-control mb-3" placeholder="Email" id="mRegisterEmail">
        <input class="form-control mb-3" placeholder="Mobile" id="mRegisterMobile">
        <button class="btn-main w-100 mb-3" onclick="register()">Create Account</button>
        <div class="text-center">
          <span class="link" onclick="showMobileLogin()">Back to Login</span>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
function showRegister(){
  loginForm.classList.add("hidden");
  registerForm.classList.remove("hidden");
  leftTitle.innerText="Create Account";
  leftDesc.innerText="Sign up to explore deals & offers";
}
function showLogin(){
  registerForm.classList.add("hidden");
  loginForm.classList.remove("hidden");
  leftTitle.innerText="Login";
  leftDesc.innerText="Get access to your Orders, Wishlist and Recommendations";
}
function showMobileRegister(){
  mLogin.classList.add("hidden");
  mRegister.classList.remove("hidden");
  mTitle.innerText="Create Account";
  mDesc.innerText="Join us for exclusive offers";
}
function showMobileLogin(){
  mRegister.classList.add("hidden");
  mLogin.classList.remove("hidden");
  mTitle.innerText="Login";
  mDesc.innerText="Access orders, wishlist & offers";
}
</script>
<script>
const API="https://maaney-backend.onrender.com";

function getVal(id){
  return document.getElementById(id)?.value.trim() || "";
}

// Check if we're on mobile or desktop
function isMobile() {
  return window.innerWidth <= 768;
}

/* REGISTER */
async function register(){
  let name, email, mobile;
  
  if (isMobile()) {
    name = getVal("mRegisterName");
    email = getVal("mRegisterEmail");
    mobile = getVal("mRegisterMobile");
  } else {
    name = getVal("registerName");
    email = getVal("registerEmail");
    mobile = getVal("registerMobile");
  }

  if(!name || !email || !mobile){
    alert("All fields are required");
    return;
  }

  try {
    const res = await fetch(API+"/register", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({name, email, mobile})
    });

    const data = await res.json();
    
    if(res.ok) {
      alert("Registration successful! Please check your email for verification.");
      if (isMobile()) {
        showMobileLogin();
      } else {
        showLogin();
      }
    } else {
      alert("Registration failed: " + (data.message || "Unknown error"));
    }
  } catch (error) {
    console.error("Registration error:", error);
    alert("Registration failed: Server error");
  }
}

/* LOGIN */
async function sendOTP(){
  let email;
  
  if (isMobile()) {
    email = getVal("mEmail");
  } else {
    email = getVal("email");
  }

  if(!email){
    alert("Enter email or mobile number");
    return;
  }

  try {
    // Show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = "Sending OTP...";
    button.disabled = true;

    // First send OTP
    const otpRes = await fetch(API+"/send-otp", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({email})
    });

    const otpData = await otpRes.json();
    
    if (!otpRes.ok) {
      throw new Error(otpData.message || "Failed to send OTP");
    }

    // Get OTP from user
    const otp = prompt("Enter OTP sent to " + email);
    
    if (!otp) {
      button.textContent = originalText;
      button.disabled = false;
      return;
    }

    // Verify OTP
    const verifyRes = await fetch(API+"/verify-otp", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({email, otp})
    });

    const verifyData = await verifyRes.json();
    
    if(verifyRes.ok) {
      // Store token if returned
      if (verifyData.token) {
        localStorage.setItem('authToken', verifyData.token);
      }
      alert("Login successful!");
      window.location.href = "home.html";
    } else {
      alert("Invalid OTP: " + (verifyData.message || "Please try again"));
    }
  } catch (error) {
    console.error("Login error:", error);
    alert("Login failed: " + error.message);
  } finally {
    // Reset button state
    const button = event.target;
    button.textContent = "Request OTP";
    button.disabled = false;
  }
}
</script>

</body>
</html>